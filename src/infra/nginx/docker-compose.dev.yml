version: "3.9"
services:
  backend:
    build: ./../src/marketgemini_backend
    container_name: mg-backend
    environment:
      - LOG_LEVEL=INFO
    expose: [ "8080" ]

  router:
    build: ./../src/marketgemini_router
    container_name: mg-router
    environment:
      - DEV_MODE=true
      - ROUTER_DEFAULT_PROVIDER=ollama
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
    expose: [ "8081" ]

  ollama:
    image: ollama/ollama:latest
    container_name: mg-ollama
    ports: [ "11434:11434" ]
    volumes: [ "ollama:/root/.ollama" ]

  nginx:
    image: nginx:stable
    container_name: mg-nginx
    depends_on: [ backend, router ]
    ports: [ "8088:8088" ]
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro

volumes:
  ollama: {}
